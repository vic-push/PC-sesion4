{"version":3,"names":["sqlite3","require","verbose","fs","location","process","env","SQLITE_DB_LOCATION","db","dbAll","dbRun","init","dirName","dirname","existsSync","mkdirSync","recursive","Promise","acc","rej","Database","err","NODE_ENV","console","log","run","result","teardown","close","getItems","all","rows","map","item","Object","assign","completed","getItem","id","storeItem","name","updateItem","removeItem","module","exports"],"sources":["sqlite.js"],"sourcesContent":["const sqlite3 = require('sqlite3').verbose();\nconst fs = require('fs');\nconst location = process.env.SQLITE_DB_LOCATION || '/tmp/todo.db';\n\nlet db, dbAll, dbRun;\n\nfunction init() {\n    const dirName = require('path').dirname(location);\n    if (!fs.existsSync(dirName)) {\n        fs.mkdirSync(dirName, { recursive: true });\n    }\n\n    return new Promise((acc, rej) => {\n        db = new sqlite3.Database(location, err => {\n            if (err) return rej(err);\n\n            if (process.env.NODE_ENV !== 'test')\n                console.log(`Using sqlite database at ${location}`);\n\n            db.run(\n                'CREATE TABLE IF NOT EXISTS todo_items (id varchar(36), name varchar(255), completed boolean)',\n                (err, result) => {\n                    if (err) return rej(err);\n                    acc();\n                },\n            );\n        });\n    });\n}\n\nasync function teardown() {\n    return new Promise((acc, rej) => {\n        db.close(err => {\n            if (err) rej(err);\n            else acc();\n        });\n    });\n}\n\nasync function getItems() {\n    return new Promise((acc, rej) => {\n        db.all('SELECT * FROM todo_items', (err, rows) => {\n            if (err) return rej(err);\n            acc(\n                rows.map(item =>\n                    Object.assign({}, item, {\n                        completed: item.completed === 1,\n                    }),\n                ),\n            );\n        });\n    });\n}\n\nasync function getItem(id) {\n    return new Promise((acc, rej) => {\n        db.all('SELECT * FROM todo_items WHERE id=?', [id], (err, rows) => {\n            if (err) return rej(err);\n            acc(\n                rows.map(item =>\n                    Object.assign({}, item, {\n                        completed: item.completed === 1,\n                    }),\n                )[0],\n            );\n        });\n    });\n}\n\nasync function storeItem(item) {\n    return new Promise((acc, rej) => {\n        db.run(\n            'INSERT INTO todo_items (id, name, completed) VALUES (?, ?, ?)',\n            [item.id, item.name, item.completed ? 1 : 0],\n            err => {\n                if (err) return rej(err);\n                acc();\n            },\n        );\n    });\n}\n\nasync function updateItem(id, item) {\n    return new Promise((acc, rej) => {\n        db.run(\n            'UPDATE todo_items SET name=?, completed=? WHERE id = ?',\n            [item.name, item.completed ? 1 : 0, id],\n            err => {\n                if (err) return rej(err);\n                acc();\n            },\n        );\n    });\n} \n\nasync function removeItem(id) {\n    return new Promise((acc, rej) => {\n        db.run('DELETE FROM todo_items WHERE id = ?', [id], err => {\n            if (err) return rej(err);\n            acc();\n        });\n    });\n}\n\nmodule.exports = {\n    init,\n    teardown,\n    getItems,\n    getItem,\n    storeItem,\n    updateItem,\n    removeItem,\n};\n"],"mappings":"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"}